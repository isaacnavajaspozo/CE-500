# Detectar tr√°fico malicioso (exploits, malware, escaneos, ataques).
# Bloquear ese tr√°fico en tiempo real.

+--------------------+--------------------------------------------+----------------------------------------------------+
| Aspecto            | Firewall                                   | IPS (Intrusion Prevention System), (surikata)      |
+--------------------+--------------------------------------------+----------------------------------------------------+
| Funci√≥n principal  | Controlar y filtrar tr√°fico seg√∫n IP,      | Detectar y bloquear ataques basados en patrones    |
|                    | puerto, protocolo                          | y comportamiento                                   |
+--------------------+--------------------------------------------+----------------------------------------------------+
| Inspecci√≥n         | B√°sica, en capa 3 y 4 (IP y transporte)    | Profunda, inspecciona capa 7 (aplicaci√≥n) y        |
|                    |                                            | patrones complejos                                 |
+--------------------+--------------------------------------------+----------------------------------------------------+
| Bloqueo            | S√≠, seg√∫n reglas est√°ticas                 | S√≠, basado en firmas y an√°lisis en tiempo real     |
+--------------------+--------------------------------------------+----------------------------------------------------+
| An√°lisis           | Limitado a atributos de red                | An√°lisis profundo del contenido y contexto         |
+--------------------+--------------------------------------------+----------------------------------------------------+
| Protecci√≥n         | General, contra accesos no autorizados     | Avanzada, contra exploits, malware, ataques        |
|                    |                                            | espec√≠ficos                                        |
+--------------------+--------------------------------------------+----------------------------------------------------+
| Ubicaci√≥n t√≠pica   | Per√≠metro o segmentos de red               | Integrado en red o en puntos cr√≠ticos para         |
|                    |                                            | detecci√≥n activa                                   |
+--------------------+--------------------------------------------+----------------------------------------------------+


#=========================================================================================================================
[üê¶‚Äç‚¨õ INSTALACI√ìN Y CONFIGURACI√ìN DE SURIKATA]::
# Instalaci√≥n b√°sica 
sudo apt install suricata suricata-update
sudo suricata-update

# Configurar interfaz de red y modo IPS
# Define la interfaz que quieres monitorizar (ejemplo eth0)
vim /etc/suricata/suricata.yaml
---------------------------------------------------
# red interna para las reglas de suricata
address-groups:
  HOME_NET: "[192.168.0.0/16,10.0.0.0/8,172.16.0.0/12]"
...
af-packet:
  - interface: eth0
    cluster-type: cluster_flow
    cluster-id: 99
    defrag: yes
...
# Configura el modo para recibir tr√°fico v√≠a NFQUEUE, aseg√∫rate de que est√© habilitado
nfqueue:
  - id: 0
    fail-open: yes
...
---------------------------------------------------

# Configurar iptables para redirigir tr√°fico a Suricata
# Si quieres proteger el tr√°fico local, cambia FORWARD por INPUT o OUTPUT seg√∫n sea necesario
sudo iptables -I FORWARD -j NFQUEUE --queue-num 0

# como es inviable gestionar de manera manual cada regla, se usan feeds de reglas actualizadas para automatizarlo
sudo apt install suricata-update
sudo suricata-update 
sudo systemctl restart suricata

# configura actualizaciones peri√≥dicas (cron job)
echo "0 3 * * * root /usr/bin/suricata-update && systemctl restart suricata" | sudo tee /etc/cron.d/suricata-update


## Crear reglas para bloquear tr√°fico
# esta forma de agregar reglas solo las voy a utilizar para reglas personalizadas (bloqueos muy espec√≠ficos)
# Ejemplo: Bloquear pings ICMP
vim /etc/suricata/rules/local.rules
---------------------------------------------------
drop icmp any any -> any any (msg:"Ping bloqueado"; sid:1000001; rev:1;)
---------------------------------------------------
    # -c especifica el archivo de configuraci√≥n
    # -q 0 indica la cola NFQUEUE a usar
    # -D corre en modo demonio
    
# Monitorizar logs y alertas
tail -f /var/log/suricata/fast.log
tail -f /var/log/suricata/eve.json | jq .


-

# ‚úÖ Resumen general:
# FQUEUE act√∫a como puente entre iptables y Suricata para el bloqueo en tiempo real.
# El rendimiento puede verse afectado si se analiza mucho tr√°fico.
# Debes mantener actualizadas las reglas para cubrir nuevas amenazas.
# Suricata puede integrarse con Elastic/Kibana para an√°lisis y visualizaci√≥n avanzada.

# ‚úÖ Resumen suricata-update:
# Descarga autom√°ticamente reglas actualizadas de fuentes oficiales (Emerging Threats, Snort, etc.).
# Filtra, combina y prepara las reglas para que Suricata las use sin conflictos.
# Gestiona reglas personalizadas junto con las oficiales sin sobrescribirlas.
# Facilita mantener el IDS/IPS actualizado con las √∫ltimas firmas de ataques y vulnerabilidades.

-
