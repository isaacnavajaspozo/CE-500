# SURIKATA ::
# Detectar tráfico malicioso (exploits, malware, escaneos, ataques).
# Bloquear ese tráfico en tiempo real.


# Instalación básica 
sudo apt install suricata-update
sudo suricata-update

# Actualizar reglas (muy importante)
sudo apt install suricata-update
sudo suricata-update

# Configurar interfaz de red y modo IPS
# Define la interfaz que quieres monitorizar (ejemplo eth0)
vim /etc/suricata/suricata.yaml
---------------------------------------------------
...
af-packet:
  - interface: eth0
    cluster-type: cluster_flow
    cluster-id: 99
    defrag: yes
...
# Configura el modo para recibir tráfico vía NFQUEUE, asegúrate de que esté habilitado
nfqueue:
  - id: 0
    fail-open: yes
...
---------------------------------------------------

# Configurar iptables para redirigir tráfico a Suricata
# Si quieres proteger el tráfico local, cambia FORWARD por INPUT o OUTPUT según sea necesario
sudo iptables -I FORWARD -j NFQUEUE --queue-num 0

# Crear reglas para bloquear tráfico (modo IPS)
# Ejemplo: Bloquear pings ICMP
vim /etc/suricata/rules/local.rules
---------------------------------------------------
drop icmp any any -> any any (msg:"Ping bloqueado"; sid:1000001; rev:1;)
---------------------------------------------------
    # -c especifica el archivo de configuración
    # -q 0 indica la cola NFQUEUE a usar
    # -D corre en modo demonio

# Monitorizar logs y alertas
tail -f /var/log/suricata/fast.log
tail -f /var/log/suricata/eve.json | jq .

-

# ✅ Resumen rápido:
# FQUEUE actúa como puente entre iptables y Suricata para el bloqueo en tiempo real.
# El rendimiento puede verse afectado si se analiza mucho tráfico.
# Debes mantener actualizadas las reglas para cubrir nuevas amenazas.
# Suricata puede integrarse con Elastic/Kibana para análisis y visualización avanzada.
