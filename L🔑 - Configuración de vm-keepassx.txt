# ðŸ§  Keepassxc se utiliza para gestionar contraseÃ±as y datos sensibles de forma segura, incluyendo 2FA.
# ðŸ§ Lo voy a utilizar para gestiÃ³n de contraseÃ±as, como alternativa de control a gestores de contraseÃ±as online.

#=========================================================================================================================
[ðŸ”‘ ce-500]::
# DocumentaciÃ³n oficial               : https://keepassxc.org/docs/KeePassXC_UserGuide#_openssh_agent_on_linux

#=========================================================================================================================
[ðŸ”‘ INSTALACIÃ“N]::
# creo una mÃ¡quina que sirva de servidor independiente desde el que puedo compartir cada base de datos de distintas maneras 
# las que aconsejo son las siguientes::
# ðŸ’ƒ dentro de un servidor samba
# ðŸ± con un repositorio git minimalista como he hecho en vm-nginx 
# ðŸ¤– a travÃ©s de un script en PowerShell

# instalo keepassxc
sudo apt install keepassxc

mkdir /KIRIBAKO/keepassxc && cd /KIRIBAKO/keepassxc 

# creo la base de datos por usuario y le agrego la contraseÃ±a
keepassxc-cli db-create usuario-db.kdbx --set-password
> **********

# compruebo la base de datos
keepassxc-cli open usuario-db.kdbx
> **********

# Ãºtiles
usuario-db.kdbx> add prueba
usuario-db.kdbx> show prueba
usuario-db.kdbx> search prueba

#=========================================================================================================================
[ðŸ”‘ CONFIGURACIÃ“N SCRIPT POWERSHELL::

# creo un usuario solo con privilegios de keepassxc
sudo adduser keepassxc
sudo mkdir /KIRIBAKO/keepassxc
sudo chown keepassxc:keepassxc /KIRIBAKO/keepassxc
# bloqueo que no pueda lanzar comandos
sudo usermod -s /usr/sbin/nologin keepassxc

# muevo la base de datos y le doy permisos
sudo chown keepassxc:keepassxc /KIRIBAKO/keepassxc/usuario-1/usuario-db.kdbx

# desde el pc Windows del usuario con el que modifico las password por
ActualizarKeePassXc.ps1
--------------------------------------------------------------------------------------
# Variables
$localFilePath = ".\keepassxc.kdbx"  # Ruta del archivo del keepassxc de Windows
$remoteServer = "keepassxc@ip-servidor-vm-keepassx"
$remoteFilePath = "/KIRIBAKO/keepassxc/usuario-1/keepassxc.kdbx"  # Ruta donde se guardarÃ¡ en el servidor por usuario

# Comprobar si el archivo local existe
if (Test-Path $localFilePath) {
    # Copiar el archivo al servidor
    # Usando SCP (asegÃºrate de tener OpenSSH instalado en Windows)
    $scpCommand = "scp $localFilePath $remoteServer:$remoteFilePath"
    
    # Ejecutar el comando SCP
    Invoke-Expression $scpCommand

    if ($LASTEXITCODE -eq 0) {
        Write-Host "La base de datos de keepassxc se ha actualizado en el servidor."
    } else {
        Write-Host "Error al copiar el archivo al servidor."
    }
} else {
    Write-Host "El archivo de keepassxc no se encuentra en la carpeta actual."
}
--------------------------------------------------------------------------------------

# guardo el script en la misma carpeta que la base de datos en el PC Windows y pulso doble click cada vez que quiero actualizar la copia al servidor
